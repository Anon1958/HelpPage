/*  ── pick a month or leave the filter out for "all months" ───────────────*/
DECLARE @target_TimePeriod_ID INT = 202506;   -- 2025‑06 for example
/*  comment the line above and the WHERE clause below if you want the list
    for every month in history                                             */

/*  STEP 1 – tag the first row we ever see for each account  */
WITH first_touch AS (
    SELECT
        act.Account_ID,                     -- or ADPAccountNumber
        act.TimePeriod_ID,
        act.ManagedAccountFlag,
        act.AccountOpenDt,                  -- bring it along if you need it
        ROW_NUMBER() OVER (
            PARTITION BY act.Account_ID
            ORDER BY     act.TimePeriod_ID
        ) AS rn_first_seen
    FROM dbo.v_M_AcctHistory AS act
)

/*  STEP 2 – pick only those whose first row is already Managed  */
SELECT
    Account_ID,
    TimePeriod_ID,
    AccountOpenDt        -- optional payload
FROM   first_touch
WHERE  rn_first_seen      = 1            -- very first snapshot
  AND  ManagedAccountFlag = 1            -- already advisory
  AND  TimePeriod_ID      = @target_TimePeriod_ID;   -- drop for "all"